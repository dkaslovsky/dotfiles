# pipe the result of gopass <secret> to gpshow to show all but the first line of gopass secret
gpshow() {
	tail -n +2 $1
	echo ""
}

# list the top level gopass directories
gpls() {
	 gopass list -f | sed 's/\/.*//' | sort | uniq
}

# find path to entry
gpfind() {
	gopass ls -f | grep -i $1
}

# grep for secret, open in Chrome, copy password to clipboard
gpopen() {

	if [ -z $1 ]; then
		echo "Pass one or two arguments"
		return 1
	fi

	# grep for path to secret
	secret_path=$(gpfind $1)
	if [ ! -z $2 ]; then
		secret_path=$(echo "$secret_path" | grep -i $2)
	fi

	# check that exactly one result was returned
	if [ -z "$secret_path" ]; then
		echo "No secrets matched"
		return 1
	fi
	if [ $(echo "$secret_path" | wc -l) -gt 1 ]; then
		echo "More than one secret matched:"
		echo "$secret_path"
		return 1
	fi

	echo "Opening $secret_path"

	# open url
	url=$(gopass $secret_path | head -n 2 | tail -n 1 | sed "s/url: //")
	open -na "Google Chrome" --args --new-window $url
	
	# copy password to clipboard
	gopass -c $secret_path

}

# given absolute path to gopass secret, get and open the url in Chrome, copy password to clipboard
#gpopen() {
#        secret_path=$(echo $1 | sed "s|$GP||" | sed "s/.gpg//")
#        url=$(gopass $secret_path | head -n 2 | tail -n 1 | sed "s/url: //")
#        open -na "Google Chrome" --args --new-window $url
#        gopass -c $secret_path
#}
