# get path to secret via grep
gpget() {

        if [ -z $1 ]; then
                echo "Must pass one or two grep arguments"
                return 1
        fi

        # grep for path to secret
        secret_path=$(gpfind $1)
        if [ ! -z $2 ]; then
                secret_path=$(echo "$secret_path" | grep -i $2)
        fi

        # check that exactly one result was returned
        if [ -z "$secret_path" ]; then
                echo "No secrets matched"
                return 1
        fi
        if [ $(echo "$secret_path" | wc -l) -gt 1 ]; then
                echo "More than one secret matched:"
                echo "$secret_path"
                return 1
        fi
	
	echo "$secret_path"
}

# show all but the password of a secret
gpshow() {
	echo ""
	gopass show $1 | tail -n +2
	echo ""
	echo ""
}

# list the top level gopass directories
gpls() {
	 gopass list -f | sed 's/\/.*//' | sort | uniq
}

# find path to entry
gpfind() {
	gopass ls -f | grep -i $1
}

# grep for secret, open in Chrome, copy password to clipboard
gpopen() {

	if [ -z $1 ]; then
		echo "Pass one or two arguments"
		return 1
	fi

	# grep for path to secret
	secret_path=$(gpfind $1)
	if [ ! -z $2 ]; then
		secret_path=$(echo "$secret_path" | grep -i $2)
	fi

	# check that exactly one result was returned
	if [ -z "$secret_path" ]; then
		echo "No secrets matched"
		return 1
	fi
	if [ $(echo "$secret_path" | wc -l) -gt 1 ]; then
		echo "More than one secret matched:"
		echo "$secret_path"
		return 1
	fi

	echo "Opening $secret_path"

	# open url
	url=$(gopass $secret_path | head -n 2 | tail -n 1 | sed "s/url: //")
	open -na "Google Chrome" --args --new-window $url
	
	# copy password to clipboard
	gopass -c $secret_path

}

